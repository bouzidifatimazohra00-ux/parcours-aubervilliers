// ================== Carte Leaflet avec popups pro ==================
const map = L.map("map").setView([48.914, 2.372], 14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);

const latlngs = [];

points.forEach(p => {
  latlngs.push(p.coords);

  // Popup HTML
  const popupContent = `
  <div style="display:flex; gap:10px; max-width:250px; font-size:14px; font-family:sans-serif;">
    <img src="${p.img}" alt="${p.name}" style="width:100px; height:70px; object-fit:cover; border-radius:6px; border:1px solid #ddd;">
    <div style="flex:1;">
      <strong>${p.id}. ${p.name}</strong><br/>
      <div style="margin:4px 0; color:#444; font-size:13px;">
        ğŸ“ ${p.coords[0].toFixed(4)}, ${p.coords[1].toFixed(4)}<br/>
        ğŸš¶ ${p.rythme} Â· ğŸ“ ${p.dim} Â· â¤ï¸ IntensitÃ© ${p.emotion}
      </div>
      <div style="font-size:13px; color:#333; margin-top:4px;">
        ${p.name === "Quartier ancien" ? "Rue ancienne avec textures et ambiance de proximitÃ©." :
          p.name === "Jardin / espace vert" ? "Pause vÃ©gÃ©tale et respiration au milieu de la ville." :
          p.name === "Studio 217 â€“ Star Academy" ? "Lieu de production audiovisuelle : univers mÃ©diatique." :
          p.name === "SupermarchÃ© proche" ? "Commerce de quartier, activitÃ© quotidienne." :
          p.name === "HumathÃ¨que" ? "BÃ¢timent institutionnel, atmosphÃ¨re studieuse." :
          p.name === "CIFA Fashion Business Center" ? "PÃ´le de mode et commerce, activitÃ© et flux." :
          "Point du parcours."}
      </div>
    </div>
  </div>
  `;

  L.circleMarker(p.coords, {
    radius: 7,
    color: "#2563eb",
    fillColor: "#2563eb",
    fillOpacity: 0.9
  }).addTo(map)
    .bindPopup(popupContent);
});

L.polyline(latlngs, { color: "#2563eb", weight: 4, opacity: 0.85 }).addTo(map);
map.fitBounds(latlngs, { padding: [30, 30] });
